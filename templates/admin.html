{% extends "base.html" %}
{% block title %}–ê–¥–º–∏–Ω ‚Äî –ü–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<link rel="stylesheet" href="/style/admin.css">
<section class="admin-page">

  <h1>üõ† –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

  <!-- –í–∫–ª–∞–¥–∫–∏ -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="applications">–ó–∞—è–≤–∫–∏</button>
    <button class="tab-btn" data-tab="theses">–¢–µ–∑–∏—Å—ã</button>
    <button class="tab-btn" data-tab="messages">–°–æ–æ–±—â–µ–Ω–∏—è</button>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞: –ó–∞—è–≤–∫–∏ -->
  <div class="tab-content" id="applications">
    {% if applications %}
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–ò–º—è</th>
          <th>Email</th>
          <th>–†–æ–ª—å</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î–∞—Ç–∞</th>
          <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
        </tr>
      </thead>
      <tbody>
        {% for app in applications %}
        <tr id="application-{{ app.id }}">
          <td>{{ app.id }}</td>
          <td>{{ app.full_name }}</td>
          <td>{{ app.email }}</td>
          <td>{{ app.role }}</td>
          <td><span class="status {{ app.status }}">{{ app.status }}</span></td>
          <td>{{ app.submitted_at.strftime("%d.%m.%Y %H:%M") }}</td>
          <td>
            {% if app.status == "pending" %}
            <button class="btn success approve-btn" data-id="{{ app.id }}">‚úî</button>
            <button class="btn danger reject-btn" data-id="{{ app.id }}">‚úñ</button>
            {% else %}‚Äî{% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>–ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</p>
    {% endif %}
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞: –¢–µ–∑–∏—Å—ã -->
  <div class="tab-content" id="theses" style="display:none;">
    {% if theses %}
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–ê–≤—Ç–æ—Ä</th>
          <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–î–∞—Ç–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for t in theses %}
        <tr>
          <td>{{ t.id }}</td>
          <td>{{ t.author.fullname }}</td>
          <td>{{ t.title }}</td>
          <td>{{ t.status }}</td>
          <td>{{ t.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>–¢–µ–∑–∏—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
    {% endif %}
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞: –°–æ–æ–±—â–µ–Ω–∏—è -->
  <div class="tab-content" id="messages" style="display:none;">
    {% if messages %}
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>–ò–º—è</th>
          <th>Email</th>
          <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
          <th>–î–∞—Ç–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for msg in messages %}
        <tr>
          <td>{{ msg.id }}</td>
          <td>{{ msg.name }}</td>
          <td>{{ msg.email }}</td>
          <td>{{ msg.message }}</td>
          <td>{{ msg.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <p>–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç</p>
    {% endif %}
  </div>

</section>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ -->
<script>
const tabs = document.querySelectorAll(".tab-btn");
const contents = document.querySelectorAll(".tab-content");

tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");

    const target = tab.dataset.tab;
    contents.forEach(c => c.style.display = c.id === target ? "block" : "none");
  });
});
</script>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ó–∞—è–≤–æ–∫ -->
<script src="/scripts/admin.js"></script>
{% endblock %}
