{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<section class="profile-page">

  <div class="profile-card">
    <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
    <p><strong>–ò–º—è:</strong> {{ user.fullname }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
  </div>

  <div class="profile-card">
    <h2>üìå –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</h2>

    {% if last_application %}
      {% if last_application.status == "approved" %}
        <span class="status approved">–û–¥–æ–±—Ä–µ–Ω–∞</span>
      {% elif last_application.status == "rejected" %}
        <span class="status rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</span>
      {% else %}
        <span class="status pending">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</span>
      {% endif %}
    {% else %}
      <span class="status none">–ó–∞—è–≤–∫–∞ –Ω–µ –ø–æ–¥–∞–Ω–∞</span>
    {% endif %}
  </div>

  <div class="profile-card">
    <h2>üìù –ú–æ–∏ —Ç–µ–∑–∏—Å—ã</h2>

    {% if theses %}
      <ul class="thesis-list">
        {% for thesis in theses %}
          <li class="thesis-item" id="thesis-{{ thesis.id }}">
            <h4>{{ thesis.title }}</h4>
            <button class="toggle-description-btn">&#x2193;</button> <!-- –°—Ç—Ä–µ–ª–∫–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è -->
            <div class="thesis-description" style="display:none;">
              <p>{{ thesis.abstract }}</p>
            </div>
            <span class="status {{ thesis.status }}">{{ thesis.status|capitalize }}</span>
            
            <!-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ -->
            <div class="thesis-actions">
              <button class="btn secondary edit-thesis-btn" data-id="{{ thesis.id }}" data-title="{{ thesis.title }}" data-abstract="{{ thesis.abstract }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
              <button class="btn danger delete-thesis-btn" data-id="{{ thesis.id }}">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="empty">–í—ã –µ—â—ë –Ω–µ –ø–æ–¥–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ–∑–∏—Å–∞</p>
    {% endif %}
  </div>

  <div class="profile-actions">
    <a href="/apply" class="btn primary">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</a>
    <a href="/thesis" class="btn secondary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∑–∏—Å—ã</a>
  </div>

</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div id="edit-thesis-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∑–∏—Å–∞</h2>
    <label for="edit-title">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
    <input type="text" id="edit-title" required>
    <label for="edit-abstract">–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è:</label>
    <textarea id="edit-abstract" rows="6" required></textarea>
    <button id="save-thesis-btn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="cancel-edit-btn" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div id="confirm-delete-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h2>
    <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ–∑–∏—Å?</p>
    <button id="confirm-delete" class="btn danger">–£–¥–∞–ª–∏—Ç—å</button>
    <button id="cancel-delete" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>
<script src="/scripts/profile.js"></script>
{% endblock %}
