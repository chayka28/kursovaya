{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<link rel="stylesheet" href="/style/profile.css">

<section class="profile-page">

  <div class="profile-card user-info">
    <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
    <p><strong>–ò–º—è:</strong> {{ user.fullname }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>–†–æ–ª—å:</strong>
      {% if last_application %}
        {{ last_application.role }}
      {% else %}
        –ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞
      {% endif %}
    </p>
    <p><strong>–ü–æ–¥–∞–Ω–æ —Ç–µ–∑–∏—Å–æ–≤:</strong> {{ theses|length }}</p>
  </div>

  <div class="profile-card application-status">
    <h2>üìå –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</h2>
    {% if last_application %}
      {% if last_application.status == "approved" %}
        <span class="status approved">–û–¥–æ–±—Ä–µ–Ω–∞</span>
      {% elif last_application.status == "rejected" %}
        <span class="status rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–∞</span>
      {% else %}
        <span class="status pending">–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</span>
      {% endif %}
    {% else %}
      <span class="status none">–ó–∞—è–≤–∫–∞ –Ω–µ –ø–æ–¥–∞–Ω–∞</span>
    {% endif %}
  </div>

  <div class="profile-card theses-section">
    <h2>üìù –ú–æ–∏ —Ç–µ–∑–∏—Å—ã</h2>

    {% if theses %}
      <ul class="thesis-list">
        {% for thesis in theses %}
        <li class="thesis-item" id="thesis-{{ thesis.id }}">
          <div class="thesis-header">
            <h4>{{ thesis.title }}</h4>

            <button class="toggle-description-btn" aria-label="–û—Ç–∫—Ä—ã—Ç—å —Ç–µ–∑–∏—Å">
              <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                <path d="M6 9l6 6 6-6" />
              </svg>
            </button>

            {% if thesis.status != "submitted" %}
              <span class="status {{ thesis.status }}">{{ thesis.status|capitalize }}</span>
            {% endif %}
          </div>

          <div class="thesis-description">
            <p>{{ thesis.abstract }}</p>
          </div>

          <div class="thesis-actions">
            <button
              class="btn secondary edit-thesis-btn"
              data-id="{{ thesis.id }}"
              data-title="{{ thesis.title }}"
              data-abstract="{{ thesis.abstract }}">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>

            <button class="button delete-thesis-btn" data-id="{{ thesis.id }}">
              <svg viewBox="0 0 448 512" class="svgIcon">
                <path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path>
              </svg>
            </button>
          </div>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="empty">–í—ã –µ—â—ë –Ω–µ –ø–æ–¥–∞–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ–∑–∏—Å–∞</p>
    {% endif %}
  </div>

  <div class="profile-actions">
    <a href="/apply" class="btn primary">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</a>

    {% if theses|length >= 5 %}
      <button class="btn secondary" disabled title="–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ 5 —Ç–µ–∑–∏—Å–æ–≤">
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∑–∏—Å—ã
      </button>
    {% else %}
      <a href="/thesis" class="btn secondary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∑–∏—Å—ã</a>
    {% endif %}
  </div>

</section>

<!-- –ú–û–î–ê–õ–ö–ò —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è (–∫–∞–∫ —É —Ç–µ–±—è) -->
<div id="edit-thesis-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∑–∏—Å–∞</h2>

    <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
    <input type="text" id="edit-title">

    <label>–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è</label>
    <textarea id="edit-abstract" rows="6"></textarea>

    <div class="modal-buttons">
      <button id="save-thesis-btn" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="cancel-edit-btn" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<div id="confirm-delete-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <h2>–£–¥–∞–ª–∏—Ç—å —Ç–µ–∑–∏—Å?</h2>
    <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>

    <div class="modal-buttons">
      <button id="confirm-delete" class="btn danger">–£–¥–∞–ª–∏—Ç—å</button>
      <button id="cancel-delete" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<script src="/scripts/profile.js"></script>
{% endblock %}
